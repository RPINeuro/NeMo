\hypertarget{neuron_8c_source}{}\section{neuron.\+c}
\label{neuron_8c_source}\index{/\+Users/\+Mark/\+Development/\+True\+North/tnt\+\_\+benchmark/models/neuron.\+c@{/\+Users/\+Mark/\+Development/\+True\+North/tnt\+\_\+benchmark/models/neuron.\+c}}

\begin{DoxyCode}
00001 \textcolor{comment}{//}
00002 \textcolor{comment}{//  neuron.c}
00003 \textcolor{comment}{//  ROSS\_TOP}
00004 \textcolor{comment}{//}
00005 \textcolor{comment}{//  Created by Mark Plagge on 6/18/15.}
00006 \textcolor{comment}{//}
00007 \textcolor{comment}{//}
00008 
00009 \textcolor{preprocessor}{#}\textcolor{preprocessor}{include} \hyperlink{neuron_8h}{"neuron.h"}
00010 
00011 \textcolor{comment}{/** @name LeakFunctions}
00012 \textcolor{comment}{ * Neuron functions that manage leaks. All voltage state saving}
00013 \textcolor{comment}{ * must be handled in the neuron event function neuronReceiveMessage().}
00014 \textcolor{comment}{ * @\{}
00015 \textcolor{comment}{ */}
\hypertarget{neuron_8c_source_l00016}{}\hyperlink{neuron_8h_a8e52befc10f975c6be39cc93af573d7e}{00016} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a8e52befc10f975c6be39cc93af573d7e}{noLeak}(\textcolor{keywordtype}{void} *neuron, tw\_stime now) \{
00017   \textcolor{comment}{// do nothing!!}
00018 \}
\hypertarget{neuron_8c_source_l00019}{}\hyperlink{neuron_8h_ac5bebec77c5216533ec5f6acd086532e}{00019} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_ac5bebec77c5216533ec5f6acd086532e}{revNoLeak}(\textcolor{keywordtype}{void} *neuron, tw\_stime now) \{
00020   \textcolor{comment}{// do nothing!!}
00021 \}
00022 \textcolor{comment}{/**}
00023 \textcolor{comment}{ *  @details LinearLeak is the standard linear leak function from the paper. Using the leakRate
       parameter inside \(\backslash\)link NeuronModel the neuron state \(\backslash\)endlink, this follows a simple linear function, reducing the
       membrane potential by a fixed rate per tick.}
00024 \textcolor{comment}{ *}
00025 \textcolor{comment}{}
00026 \textcolor{comment}{ *  @see NeuronModel}
00027 \textcolor{comment}{ */}
\hypertarget{neuron_8c_source_l00028}{}\hyperlink{neuron_8h_a64dc379b459a2b07b40bce35381210e8}{00028} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a64dc379b459a2b07b40bce35381210e8}{linearLeak}(\textcolor{keywordtype}{void} *neuron, tw\_stime now) \{
00029     neuronState *s = (neuronState *)neuron;
00030     tw\_stime bigTick = getCurrentBigTick(now);
00031     tw\_stime delta = bigTick - s->lastLeakTime;
00032 
00033     s->membranePot -= s->leakRate * delta;
00034     s->lastLeakTime = now;
00035 \}
00036 
\hypertarget{neuron_8c_source_l00037}{}\hyperlink{neuron_8h_a26ced40d7ad7a0b448a136d8724fe18b}{00037} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a26ced40d7ad7a0b448a136d8724fe18b}{revLinearLeak}(\textcolor{keywordtype}{void} *neuron, tw\_stime now)\{
00038     neuronState *s = (neuronState *)neuron;
00039     tw\_stime delta = s->lastLeakTime - now;
00040 
00041     s->membranePot += s->leakRate * delta;
00042     s->lastLeakTime = now;
00043 \}
00044 
00045 
00046 
00047 \textcolor{comment}{/** @\}*/}
00048 \textcolor{comment}{/** @name ResetFunctions  }
00049 \textcolor{comment}{ Reset function defs. Neuron reset functions will}
00050 \textcolor{comment}{ change the neuron state without saving the previous state. All voltage state saving}
00051 \textcolor{comment}{ must be handled in the neuron event function neuronReceiveMessage(). }
00052 \textcolor{comment}{ @todo: Check that reverse reset functions are needed, since previous voltage is stored in the neuron.}
00053 \textcolor{comment}{ * @\{ */}
00054 
00055 
\hypertarget{neuron_8c_source_l00056}{}\hyperlink{neuron_8h_a7f8eaa35f03747c795a2b727b364537b}{00056} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a7f8eaa35f03747c795a2b727b364537b}{resetZero}(\textcolor{keywordtype}{void} *neuronState) \{
00057     \textcolor{keyword}{struct} \hyperlink{structneuron_state}{NeuronModel} *s = (\textcolor{keyword}{struct} \hyperlink{structneuron_state}{NeuronModel} *)neuronState;
00058     s\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot} = 0; \textcolor{comment}{// set current voltage to 0.}
00059 \}
00060 
00061 \textcolor{comment}{/**}
00062 \textcolor{comment}{ *  @details  Note: Linear functions use the \(\backslash\)link \_voltT voltT \(\backslash\)endlink data type.}
00063 \textcolor{comment}{ *  If a neuron uses a linear reset, this parameter must be set upon neuron creation. }
00064 \textcolor{comment}{ @todo: Check implementation against paper.}
00065 \textcolor{comment}{ *}
00066 \textcolor{comment}{ */}
\hypertarget{neuron_8c_source_l00067}{}\hyperlink{neuron_8h_a2e78d7d2b70bf7349c3854b3727dcc25}{00067} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a2e78d7d2b70bf7349c3854b3727dcc25}{resetLinear}(\textcolor{keywordtype}{void} *neuronState) \{
00068     \textcolor{keyword}{struct} \hyperlink{structneuron_state}{NeuronModel} *s = (\textcolor{keyword}{struct} \hyperlink{structneuron_state}{NeuronModel} *)neuronState;
00069   \textcolor{comment}{// reduce the value of the neuron based on the linear reduction function}
00070   \textcolor{comment}{// in the paper}
00071     \hyperlink{assist_8h_abe1fc1b8f9efd1187e564bcb8de7f815}{\_voltT} resetParam = (\hyperlink{assist_8h_abe1fc1b8f9efd1187e564bcb8de7f815}{\_voltT}) &resetParam;
00072   s\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot} = s\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot} - resetParam;
00073 \}
00074 
\hypertarget{neuron_8c_source_l00075}{}\hyperlink{neuron_8h_a09e54832158e2f6abe898437979aae00}{00075} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a09e54832158e2f6abe898437979aae00}{reverseResetLinear}(\textcolor{keywordtype}{void} *neuronState)\{
00076     \textcolor{keyword}{struct} \hyperlink{structneuron_state}{NeuronModel} *s = (\textcolor{keyword}{struct} \hyperlink{structneuron_state}{NeuronModel} *)neuronState;
00077     \hyperlink{assist_8h_abe1fc1b8f9efd1187e564bcb8de7f815}{\_voltT} resetParam = (\hyperlink{assist_8h_abe1fc1b8f9efd1187e564bcb8de7f815}{\_voltT}) &resetParam;
00078     s\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot} = s\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot} + resetParam;
00079 \}
00080 \textcolor{comment}{/** @todo: Check that this is the proper way to handle reset zero function */}
\hypertarget{neuron_8c_source_l00081}{}\hyperlink{neuron_8h_ae53276ccdb759ba1ea09806cbf9fc940}{00081} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_ae53276ccdb759ba1ea09806cbf9fc940}{reverseResetZero}(\textcolor{keywordtype}{void} *neuronState)\{
00082 
00083 \}
00084 
00085 
00086     \textcolor{comment}{/** @\} */}
00087 
00088 \textcolor{comment}{/** @name NeuronFunctions }
00089 \textcolor{comment}{* Main neuron functions and behaviors}
00090 \textcolor{comment}{*  @\{ }
00091 \textcolor{comment}{ */}
00092 
00093 \textcolor{comment}{/**}
00094 \textcolor{comment}{ *  @details  neruonReceiveMessage runs when an event is received by a neuron.}
00095 \textcolor{comment}{ *  The events are handled in the following fashion:}
00096 \textcolor{comment}{ *  - If the event is a synapse, the neuron integrates the weight of the synapse into its membrane
       potential.}
00097 \textcolor{comment}{ *    - The count of big-tick synapse messages recived is incremented.}
00098 \textcolor{comment}{ *    - If the count changes from zero to one, the function creates and queues a heartbeat event for
       the next big-tick.}
00099 \textcolor{comment}{ *  - If the event is a heartbeat, the neuron will leak, potentially fire, and reset.}
00100 \textcolor{comment}{ *}
00101 \textcolor{comment}{ *  Big-Tick events are sent at time \(\backslash\)f$𝒯\_\{bigTick\} - ε\(\backslash\)f$, so that the the event will arrive at the
       next bit-tick time.}
00102 \textcolor{comment}{ *}
00103 \textcolor{comment}{ */}
\hypertarget{neuron_8c_source_l00104}{}\hyperlink{neuron_8h_aa6819d7492f0173f2234ba0b8b0bb674}{00104} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_aa6819d7492f0173f2234ba0b8b0bb674}{neuronReceiveMessage}(neuronState *st, tw\_stime time, Msg\_Data *m,
00105 tw\_lp *lp)\{
00106     \textcolor{keywordtype}{bool} willFire = \textcolor{keyword}{false};
00107         \textcolor{comment}{//save the previous state of the neuron:}
00108     st->savedLastLeakTime = st->lastLeakTime;
00109     st->savedLastActiveTime = st->lastActiveTime;
00110     st\hyperlink{structneuron_state_a5efe5de0478ea513ed5d90d89a49fcca}{->}\hyperlink{structneuron_state_a5efe5de0478ea513ed5d90d89a49fcca}{savedMembranePot} = st\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot};
00111         \textcolor{comment}{//random fn call state management.}
00112     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} startCount = lp->rng->count;
00113 
00114     \textcolor{keywordflow}{switch} (m\hyperlink{struct_msg___data_a015b6eb45982e1842ee8fc389a099ced}{->}\hyperlink{struct_msg___data_a015b6eb45982e1842ee8fc389a099ced}{eventType}) \{
00115   \textcolor{keywordflow}{case} SYNAPSE\_OUT:
00116             integrateSynapse(m->localID, st, lp);
00117 
00118                 \textcolor{comment}{//next, we will check if a heartbeat message should be sent}
00119             \textcolor{keywordflow}{if}(st\hyperlink{structneuron_state_af8935bcba177f2f3dfb9119c39ef7dc5}{->}\hyperlink{structneuron_state_af8935bcba177f2f3dfb9119c39ef7dc5}{receivedSynapseMsgs} == 0) \{
00120                 sendHeartbeat(st, lp, time);
00121             \}
00122             st\hyperlink{structneuron_state_af8935bcba177f2f3dfb9119c39ef7dc5}{->}\hyperlink{structneuron_state_af8935bcba177f2f3dfb9119c39ef7dc5}{receivedSynapseMsgs} ++;
00123 
00124 
00125             \textcolor{keywordflow}{break};
00126 
00127         \textcolor{keywordflow}{case} \hyperlink{assist_8h_a7c1688de451e0dea1e11617bce3ec450a226690009a653238a52339561e6c466e}{NEURON\_HEARTBEAT}:
00128             st\hyperlink{structneuron_state_af8935bcba177f2f3dfb9119c39ef7dc5}{->}\hyperlink{structneuron_state_af8935bcba177f2f3dfb9119c39ef7dc5}{receivedSynapseMsgs} = 0;
00129 
00130                 \textcolor{comment}{//Currently operates - leak->fire->(reset)}
00131             st->doLeak(st, time);
00132             willFire = \hyperlink{neuron_8h_a92d5882a15e11e2a6733483d51428e46}{neuronShouldFire}\hyperlink{neuron_8h_a92d5882a15e11e2a6733483d51428e46}{(}st\hyperlink{neuron_8h_a92d5882a15e11e2a6733483d51428e46}{)};
00133             \textcolor{keywordflow}{if}(willFire)\{
00134                 neuronFire(st, time, m);
00135                 neuronPostFire(st, time, m);
00136                 st\hyperlink{structneuron_state_afe8825076c4cf3863c677307fec63c61}{->}\hyperlink{structneuron_state_afe8825076c4cf3863c677307fec63c61}{fireCount} ++;
00137             \}
00138 
00139             neuronPostIntegrate(st, time, lp, willFire);
00140             \textcolor{comment}{//stats collection}
00141             st\hyperlink{structneuron_state_a71fbb9a79e8048b473b6e09d29a64bbe}{->}\hyperlink{structneuron_state_a71fbb9a79e8048b473b6e09d29a64bbe}{SOPSCount} ++;
00142             \textcolor{keywordflow}{break};
00143 
00144   \textcolor{keywordflow}{default}:
00145                 \textcolor{comment}{//Error condition - non-valid input.}
00146             \textcolor{keywordflow}{break};
00147     \}
00148 
00149         \textcolor{comment}{//store the random calls in the message:}
00150     m->rndCallCount = lp->rng->count - startCount;
00151 
00152     st\hyperlink{structneuron_state_ab8f63a1dfdb2992657530ff8a63fdc01}{->}\hyperlink{structneuron_state_ab8f63a1dfdb2992657530ff8a63fdc01}{rcvdMsgCount} ++;
00153 
00154 
00155 
00156 \}
\hypertarget{neuron_8c_source_l00157}{}\hyperlink{neuron_8h_a92d5882a15e11e2a6733483d51428e46}{00157} \textcolor{keywordtype}{bool} \hyperlink{neuron_8h_a92d5882a15e11e2a6733483d51428e46}{neuronShouldFire}(neuronState *st)\{
00158         \textcolor{comment}{//check negative threshold values:}
00159     \textcolor{keywordflow}{if}(st->membranePot < ) \{
00160         \textcolor{keywordflow}{if}(st->negThresReset) \{
00161                 \textcolor{comment}{//reset to \(\backslash\)f$－β\_j\(\backslash\)f$}
00162         \}
00163     \}
00164     \textcolor{keywordflow}{return} st\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{->}\hyperlink{structneuron_state_a0fdd8f44c4105a94e17c4c58a51db486}{membranePot} > st\hyperlink{structneuron_state_a132470c4c17828c209e3403ccf7ee680}{->}\hyperlink{structneuron_state_a132470c4c17828c209e3403ccf7ee680}{threshold};
00165 \}
\hypertarget{neuron_8c_source_l00166}{}\hyperlink{neuron_8h_ae071ef984b7e0dd4ec38fca91e0abe39}{00166} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_ae071ef984b7e0dd4ec38fca91e0abe39}{neuronFire}(neuronState *st, tw\_stime time, Msg\_Data *m)\{
00167 
00168 \}
\hypertarget{neuron_8c_source_l00169}{}\hyperlink{neuron_8h_ab1f4997e4bfe11e78faa6d37748aee67}{00169} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_ab1f4997e4bfe11e78faa6d37748aee67}{neuronPostFire}(neuronState *st, tw\_stime time, Msg\_Data *m)\{
00170 
00171 \}
\hypertarget{neuron_8c_source_l00172}{}\hyperlink{neuron_8h_a06ee765bfae45fe9b7f0619bf4abe63d}{00172} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_a06ee765bfae45fe9b7f0619bf4abe63d}{generateWaitEvent}(neuronState *st, tw\_stime time, tw\_lp *lp)\{
00173 
00174 \}
\hypertarget{neuron_8c_source_l00175}{}\hyperlink{neuron_8h_ae630bdf5dd3744870968f07a6971659c}{00175} \textcolor{keywordtype}{void} \hyperlink{neuron_8h_ae630bdf5dd3744870968f07a6971659c}{integrateSynapse}(\hyperlink{assist_8h_a3f7a6e6a1210b6d9d7a42177dcb9634b}{\_idT} synapseID,neuronState *st, tw\_lp *lp) \{
00176     \hyperlink{assist_8h_abe1fc1b8f9efd1187e564bcb8de7f815}{\_voltT} adjustedWeight;
00177     \textcolor{keywordflow}{if}(st->perSynapseDet[synapseID] == \textcolor{keyword}{true}) \{
00178         adjustedWeight = st->perSynapseWeight[synapseID];
00179         st->membranePot += adjustedWeight;
00180     \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{//stochastic mode weights:}
00181         \hyperlink{assist_8h_abe1fc1b8f9efd1187e564bcb8de7f815}{\_voltT} rand = tw\_rand\_integer(lp->rng, st->, <#\textcolor{keywordtype}{long} high#>)
00182 
00183 \}
00184 
00185 \textcolor{keywordtype}{void} neuronPostIntegrate(neuronState *st, tw\_stime time, tw\_lp *lp, \textcolor{keywordtype}{bool} didFire)\{
00186 
00187 \}
00188 \textcolor{comment}{/** @\} */}
\end{DoxyCode}
